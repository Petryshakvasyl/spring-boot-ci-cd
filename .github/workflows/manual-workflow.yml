name: DB migration workflow

on:
  workflow_dispatch:
    inputs:
      my-var:
        description: "This my txt var"
        default: 'tmp'
      repository:
        description: "Select the repository"
        type: choice
        options:
           - spring-boot-cicd
           - SimpleSpringBoot
#      repository2:
#        type: choice
#        options:
#          # Use the GitHub API to list all your repositories.
#          - {{ actions/checkout@v3 | github.repository_list | map((repo) => { return repo.name + ': ' + repo.description }) }}

env:
  # Setting an environment variable with the value of a configuration variable
  env_var: ${{ vars.ENV_CONTEXT_VAR }}

jobs:
  job-1-checkout-repositories:
    name: Job 1 - Checkout repositories
    runs-on: ubuntu-latest
    environment: ${{ vars.ENVIRONMENT_STAGE }}
    steps:
      - name: Job 1 - Step 1 - Print inputs
        id: job-1-step-1
        run: |
          echo "My var = ${{ github.event.inputs.my-var }}"
          echo "repository = ${{ github.event.inputs.repository }}"
          echo "repository variable : $REPOSITORY_VAR"
          echo "organization variable : $ORGANIZATION_VAR"
          echo "overridden variable : $OVERRIDE_VAR"
          echo "variable from shell environment : $env_var"
          echo "repository list ${{ github.repository_list }}"
        shell: bash

      - name: Job 1 - Step 2 - Checkout repository
        id: job-1-step-2
        uses: actions/checkout@v3
        with:
          ref: ${{ github.ref_name }}
          path: relative-directory-for-repo

      - name: Job 1 - Step 3 - Print outputs
        id: job-1-step-3
        run: |
          echo "sha from checkout output  = ${{ steps.job-1-step-2.outputs.sha }}"
          echo "sha for master branch  = ${{ github.ref == 'refs/heads/master' && github.sha }}"
          echo "sha for configure-cicd branch  = ${{ github.ref == 'refs/heads/configure-cicd' && github.sha }}"
        shell: bash
